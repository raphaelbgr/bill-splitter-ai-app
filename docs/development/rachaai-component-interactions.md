# RachaAI - Component Interaction Specifications
## Brazilian Cultural Context & Accessibility-First Design

*Generated by Sally - UX Expert & Interaction Specialist*
*Created: December 2024*

---

## Component Interaction Overview

This document specifies detailed component interactions for RachaAI's key user scenarios, designed with Brazilian cultural context and accessibility-first principles.

---

## 1. Rod√≠zio Japon√™s Interaction Flow

### 1.1 Initial Recognition Component

**Component:** `CulturalPatternRecognition`

```typescript
interface RodizioInteraction {
  trigger: string; // "rod√≠zio", "rolou um rod√≠zio", "japon√™s"
  confidence: number; // 0.95
  regionalVariations: {
    SP: ["rolou um rod√≠zio", "rod√≠zio japon√™s"],
    RJ: ["beleza, rod√≠zio", "rod√≠zio top"],
    NE: ["oxe, rod√≠zio", "rod√≠zio massa"],
    Sul: ["bah, rod√≠zio", "rod√≠zio guri"]
  };
  culturalContext: {
    divisionType: "equal"; // Todos pagam igual
    explanation: "No rod√≠zio, todos pagam o mesmo valor";
    regionalExplanation: {
      SP: "Rolou um rod√≠zio japon√™s, cada um paga igual",
      RJ: "Beleza, rod√≠zio japon√™s, divis√£o igual",
      NE: "Oxe, rod√≠zio japon√™s, cada um paga igual",
      Sul: "Bah, rod√≠zio japon√™s, divis√£o igual"
    }
  };
}

// Interaction Flow
const rodizioInteraction = {
  // 1. User Input Recognition
  userInput: "Rolou um rod√≠zio japon√™s, 4 pessoas, R$ 180",
  
  // 2. Cultural Pattern Detection
  patternDetection: {
    type: "rod√≠zio",
    confidence: 0.95,
    region: "SP",
    participants: 4,
    totalAmount: 180,
    divisionType: "equal"
  },
  
  // 3. Regional Adaptation
  regionalAdaptation: {
    message: "Rolou um rod√≠zio japon√™s! üç£",
    explanation: "No rod√≠zio, todos pagam igual",
    calculation: "R$ 180 √∑ 4 = R$ 45 cada"
  },
  
  // 4. Screen Reader Announcement
  accessibilityAnnouncement: {
    pattern: "Padr√£o cultural detectado: Rod√≠zio japon√™s",
    explanation: "No rod√≠zio, todos pagam igual",
    calculation: "R$ 45 cada pessoa"
  },
  
  // 5. Payment Integration
  paymentIntegration: {
    type: "PIX",
    amount: 45,
    recipients: 4,
    sharingOptions: ["WhatsApp", "Email", "Copy PIX Key"]
  }
};
```

### 1.2 Confirmation Interaction

**Component:** `ExpenseConfirmation`

```typescript
interface RodizioConfirmation {
  // Visual Feedback
  visualFeedback: {
    animation: "success-pulse",
    icon: "üç£",
    color: "#10B981", // Success green
    message: "Rod√≠zio confirmado!"
  };
  
  // Audio Feedback
  audioFeedback: {
    sound: "success-chime",
    screenReader: "Rod√≠zio japon√™s confirmado, R$ 45 cada"
  };
  
  // Haptic Feedback (Mobile)
  hapticFeedback: {
    type: "success",
    pattern: "short-vibration"
  };
  
  // Keyboard Navigation
  keyboardNavigation: {
    focusOrder: [
      "confirm-button",
      "customize-button", 
      "explain-button",
      "share-button"
    ],
    shortcuts: {
      "Enter": "confirm",
      "Space": "customize",
      "Escape": "cancel"
    }
  };
}
```

---

## 2. Happy Hour Interaction Flow

### 2.1 Complex Division Recognition

**Component:** `ComplexDivisionRecognition`

```typescript
interface HappyHourInteraction {
  trigger: string; // "happy hour", "happy", "HH"
  complexity: "complex"; // Divis√£o por consumo
  culturalContext: {
    divisionType: "consumption"; // Cada um paga o que consumiu
    explanation: "No happy hour, cada um paga o que bebeu",
    regionalVariations: {
      SP: "Happy hour, cada um paga o seu",
      RJ: "Beleza, happy hour, cada um paga o que bebeu",
      NE: "Oxe, happy hour, cada um paga o seu",
      Sul: "Bah, happy hour, cada um paga o que bebeu"
    }
  };
}

// Interaction Flow
const happyHourInteraction = {
  // 1. User Input with Consumption Details
  userInput: "Happy hour, 6 pessoas, R$ 240, mas cada um bebeu diferente",
  
  // 2. Complex Pattern Detection
  patternDetection: {
    type: "happy_hour",
    complexity: "consumption_based",
    participants: 6,
    totalAmount: 240,
    requiresIndividualInput: true
  },
  
  // 3. Individual Consumption Collection
  consumptionCollection: {
    interface: "IndividualConsumptionInput",
    fields: [
      "Jo√£o: R$ 45 (2 cervejas + petisco)",
      "Maria: R$ 35 (1 caipirinha)",
      "Pedro: R$ 50 (3 cervejas)",
      "Ana: R$ 40 (2 drinks)",
      "Carlos: R$ 35 (1 cerveja + petisco)",
      "Lucia: R$ 35 (1 drink + petisco)"
    ],
    validation: {
      total: 240,
      tolerance: 2 // Allow small rounding differences
    }
  },
  
  // 4. Accessibility Support
  accessibilitySupport: {
    screenReader: "Happy hour detectado. Cada pessoa paga o que consumiu.",
    voiceInput: "Jo√£o, 45 reais. Maria, 35 reais...",
    keyboardNavigation: "Tab through each person's consumption"
  },
  
  // 5. Confirmation with Details
  confirmation: {
    summary: "Happy hour confirmado!",
    details: "Cada um paga o que consumiu",
    individualPayments: [
      "Jo√£o: R$ 45",
      "Maria: R$ 35", 
      "Pedro: R$ 50",
      "Ana: R$ 40",
      "Carlos: R$ 35",
      "Lucia: R$ 35"
    ]
  }
};
```

---

## 3. Anivers√°rio Interaction Flow

### 3.1 Birthday Person Exclusion

**Component:** `BirthdayExclusion`

```typescript
interface AniversarioInteraction {
  trigger: string; // "anivers√°rio", "anivers√°rio meu", "festa"
  culturalContext: {
    birthdayPersonExclusion: true,
    explanation: "O aniversariante n√£o paga",
    regionalVariations: {
      SP: "Anivers√°rio meu, eu n√£o pago!",
      RJ: "Beleza, anivers√°rio, eu n√£o pago",
      NE: "Oxe, anivers√°rio, eu n√£o pago",
      Sul: "Bah, anivers√°rio, eu n√£o pago"
    }
  };
}

// Interaction Flow
const aniversarioInteraction = {
  // 1. Birthday Pattern Detection
  userInput: "Anivers√°rio meu, 8 pessoas, R$ 240",
  
  // 2. Birthday Person Identification
  birthdayDetection: {
    type: "anivers√°rio",
    birthdayPerson: "user", // Current user
    participants: 8,
    totalAmount: 240,
    payingParticipants: 7 // Excluding birthday person
  },
  
  // 3. Calculation with Exclusion
  calculation: {
    totalAmount: 240,
    payingParticipants: 7,
    individualPayment: 240 / 7, // R$ 34.29
    birthdayPersonPayment: 0
  },
  
  // 4. Screen Reader Announcement
  accessibilityAnnouncement: {
    pattern: "Padr√£o cultural: Anivers√°rio - aniversariante n√£o paga",
    explanation: "No anivers√°rio, o aniversariante n√£o paga",
    calculation: "7 amigos pagam R$ 34,29 cada"
  },
  
  // 5. Payment Distribution
  paymentDistribution: {
    birthdayPerson: {
      name: "Voc√™",
      payment: 0,
      message: "Parab√©ns! Voc√™ n√£o paga üéâ"
    },
    friends: [
      { name: "Jo√£o", payment: 34.29 },
      { name: "Maria", payment: 34.29 },
      { name: "Pedro", payment: 34.29 },
      { name: "Ana", payment: 34.29 },
      { name: "Carlos", payment: 34.29 },
      { name: "Lucia", payment: 34.29 },
      { name: "Paulo", payment: 34.29 }
    ]
  }
};
```

---

## 4. Churrasco Interaction Flow

### 4.1 Contribution-Based Division

**Component:** `ContributionBasedDivision`

```typescript
interface ChurrascoInteraction {
  trigger: string; // "churrasco", "churras", "carne"
  culturalContext: {
    divisionType: "contribution", // Cada um leva algo
    explanation: "No churrasco, cada um leva algo diferente",
    regionalVariations: {
      SP: "Churrasco fam√≠lia, cada um leva algo",
      RJ: "Beleza, churrasco, cada um leva algo",
      NE: "Oxe, churrasco, cada um leva algo",
      Sul: "Bah, churrasco, cada um leva algo"
    }
  };
}

// Interaction Flow
const churrascoInteraction = {
  // 1. Churrasco Pattern Detection
  userInput: "Churrasco fam√≠lia, 10 pessoas, R$ 300",
  
  // 2. Contribution Collection Interface
  contributionInterface: {
    type: "ContributionInput",
    categories: [
      "Carne (R$ 120)",
      "Bebidas (R$ 80)", 
      "Saladas (R$ 40)",
      "P√£o de alho (R$ 20)",
      "Sobremesa (R$ 40)"
    ],
    contributors: [
      "Jo√£o: Carne",
      "Maria: Bebidas",
      "Pedro: Saladas",
      "Ana: P√£o de alho",
      "Carlos: Sobremesa"
    ]
  },
  
  // 3. Fair Division Calculation
  calculation: {
    totalCost: 300,
    contributors: 5,
    nonContributors: 5,
    contributionValue: 60, // R$ 300 √∑ 5
    individualPayment: 30 // R$ 300 √∑ 10
  },
  
  // 4. Accessibility Support
  accessibilitySupport: {
    screenReader: "Churrasco fam√≠lia detectado. Cada um leva algo.",
    voiceInput: "Jo√£o leva carne, Maria leva bebidas...",
    keyboardNavigation: "Tab through contribution categories"
  },
  
  // 5. Payment Summary
  paymentSummary: {
    contributors: [
      "Jo√£o: R$ 60 (carne) - R$ 30 = R$ 30 recebe",
      "Maria: R$ 60 (bebidas) - R$ 30 = R$ 30 recebe",
      "Pedro: R$ 60 (saladas) - R$ 30 = R$ 30 recebe",
      "Ana: R$ 60 (p√£o) - R$ 30 = R$ 30 recebe", 
      "Carlos: R$ 60 (sobremesa) - R$ 30 = R$ 30 recebe"
    ],
    nonContributors: [
      "Lucia: R$ 30 paga",
      "Paulo: R$ 30 paga",
      "Fernanda: R$ 30 paga",
      "Ricardo: R$ 30 paga",
      "Beatriz: R$ 30 paga"
    ]
  }
};
```

---

## 5. Vaquinha Interaction Flow

### 5.1 Group Contribution Tracking

**Component:** `GroupContributionTracking`

```typescript
interface VaquinhaInteraction {
  trigger: string; // "vaquinha", "vaquinha", "presente"
  culturalContext: {
    divisionType: "fixed_contribution", // Valor fixo por pessoa
    explanation: "Na vaquinha, cada um contribui o mesmo valor",
    regionalVariations: {
      SP: "Vaquinha presente, cada um contribui igual",
      RJ: "Beleza, vaquinha, cada um contribui igual",
      NE: "Oxe, vaquinha, cada um contribui igual",
      Sul: "Bah, vaquinha, cada um contribui igual"
    }
  };
}

// Interaction Flow
const vaquinhaInteraction = {
  // 1. Vaquinha Pattern Detection
  userInput: "Vaquinha presente casamento, 20 pessoas, R$ 1000",
  
  // 2. Fixed Contribution Calculation
  calculation: {
    type: "vaquinha",
    totalAmount: 1000,
    participants: 20,
    individualContribution: 50, // R$ 1000 √∑ 20
    purpose: "presente casamento"
  },
  
  // 3. Progress Tracking Interface
  progressInterface: {
    type: "ProgressTracker",
    totalContributors: 20,
    currentContributors: 0,
    progressBar: {
      current: 0,
      total: 20,
      percentage: 0
    },
    contributors: []
  },
  
  // 4. Accessibility Support
  accessibilitySupport: {
    screenReader: "Vaquinha detectada. Cada pessoa contribui R$ 50.",
    progressAnnouncement: "Progresso: 0 de 20 contribu√≠ram",
    keyboardNavigation: "Tab through contributor list"
  },
  
  // 5. Contribution Management
  contributionManagement: {
    addContributor: {
      interface: "AddContributor",
      fields: ["Nome", "Valor", "Data"],
      validation: {
        amount: 50,
        tolerance: 5 // Allow small variations
      }
    },
    progressUpdate: {
      screenReader: "Jo√£o contribuiu R$ 50. Progresso: 1 de 20",
      visualFeedback: "success-pulse",
      hapticFeedback: "short-vibration"
    }
  }
};
```

---

## 6. Voice Input Interaction Flow

### 6.1 Brazilian Portuguese Voice Recognition

**Component:** `VoiceInputRecognition`

```typescript
interface VoiceInputInteraction {
  // Voice Recognition Setup
  voiceSetup: {
    language: "pt-BR",
    regionalAccents: ["SP", "RJ", "NE", "Sul"],
    culturalPatterns: [
      "rod√≠zio", "happy hour", "anivers√°rio", 
      "churrasco", "vaquinha"
    ]
  };
  
  // Interaction Flow
  voiceInteraction: {
    // 1. Voice Activation
    activation: {
      trigger: "microphone button",
      feedback: {
        visual: "recording-pulse",
        audio: "activation-sound",
        haptic: "long-vibration"
      },
      screenReader: "Microfone ativado. Fale sua despesa."
    },
    
    // 2. Voice Recording
    recording: {
      duration: "unlimited",
      feedback: {
        visual: "waveform-animation",
        audio: "real-time-feedback",
        haptic: "continuous-vibration"
      },
      screenReader: "Gravando √°udio..."
    },
    
    // 3. Speech Recognition
    recognition: {
      engine: "Web Speech API",
      language: "pt-BR",
      regionalAdaptation: {
        SP: "S√£o Paulo accent",
        RJ: "Carioca accent", 
        NE: "Nordestino accent",
        Sul: "Ga√∫cho accent"
      },
      culturalPatterns: [
        "rolou um rod√≠zio",
        "beleza, happy hour",
        "oxe, churrasco",
        "bah, anivers√°rio"
      ]
    },
    
    // 4. Text Processing
    processing: {
      regionalDetection: "automatic",
      culturalPatternDetection: "automatic",
      confidence: "high",
      alternatives: "show if low confidence"
    },
    
    // 5. Confirmation
    confirmation: {
      display: "recognized text",
      edit: "tap to edit",
      confirm: "send button",
      screenReader: "Reconhecido: Rolou um rod√≠zio japon√™s, 4 pessoas"
    }
  };
}
```

---

## 7. Camera Integration Interaction Flow

### 7.1 Receipt Scanning

**Component:** `ReceiptScanner`

```typescript
interface ReceiptScannerInteraction {
  // Camera Setup
  cameraSetup: {
    resolution: "1080p",
    focus: "auto",
    flash: "auto",
    stabilization: "enabled"
  };
  
  // Interaction Flow
  receiptInteraction: {
    // 1. Camera Activation
    activation: {
      trigger: "camera button",
      permission: "request camera access",
      feedback: {
        visual: "camera-preview",
        audio: "camera-sound",
        haptic: "short-vibration"
      },
      screenReader: "C√¢mera ativada. Posicione o recibo na tela."
    },
    
    // 2. Receipt Detection
    detection: {
      algorithm: "OCR + ML",
      languages: ["pt-BR", "en"],
      currencies: ["BRL", "USD"],
      patterns: [
        "restaurant receipt",
        "bar receipt", 
        "store receipt"
      ],
      feedback: {
        visual: "detection-frame",
        audio: "detection-sound",
        haptic: "double-vibration"
      }
    },
    
    // 3. Data Extraction
    extraction: {
      fields: [
        "establishment",
        "date",
        "time",
        "total_amount",
        "items",
        "participants"
      ],
      validation: {
        required: ["total_amount"],
        optional: ["participants", "items"]
      }
    },
    
    // 4. Manual Correction
    correction: {
      interface: "EditReceipt",
      fields: [
        "Estabelecimento",
        "Data",
        "Valor total",
        "Participantes"
      ],
      keyboardNavigation: "Tab through fields",
      screenReader: "Editar dados do recibo"
    },
    
    // 5. Integration
    integration: {
      automatic: "send to Claude",
      manual: "review and send",
      screenReader: "Recibo processado. Enviando para Claude..."
    }
  };
}
```

---

## 8. Accessibility Interaction Patterns

### 8.1 Screen Reader Support

**Component:** `ScreenReaderSupport`

```typescript
interface ScreenReaderInteraction {
  // Announcement Patterns
  announcements: {
    // Cultural Pattern Detection
    patternDetection: {
      rodizio: "Padr√£o cultural detectado: Rod√≠zio japon√™s",
      happyHour: "Padr√£o cultural detectado: Happy Hour",
      aniversario: "Padr√£o cultural detectado: Anivers√°rio",
      churrasco: "Padr√£o cultural detectado: Churrasco",
      vaquinha: "Padr√£o cultural detectado: Vaquinha"
    },
    
    // Calculation Results
    calculations: {
      equal: "Divis√£o igual: R$ {amount} cada",
      consumption: "Divis√£o por consumo: {details}",
      birthday: "Aniversariante n√£o paga. {friends} pagam R$ {amount} cada",
      contribution: "Divis√£o por contribui√ß√£o: {details}",
      fixed: "Contribui√ß√£o fixa: R$ {amount} cada"
    },
    
    // Payment Integration
    payments: {
      pixGenerated: "PIX gerado para {recipient}: R$ {amount}",
      qrCode: "QR Code PIX para {recipient}, R$ {amount}. Toque para ampliar",
      sharing: "Compartilhar via {method}"
    },
    
    // Loading States
    loading: {
      claude: "Claude est√° processando",
      haiku: "Processando com Claude Haiku (r√°pido)",
      sonnet: "Processando com Claude Sonnet (preciso)",
      opus: "Processando com Claude Opus (avan√ßado)"
    }
  };
  
  // Navigation Patterns
  navigation: {
    // Tab Order
    tabOrder: [
      "message-input",
      "send-button", 
      "voice-button",
      "camera-button",
      "confirm-button",
      "customize-button",
      "explain-button",
      "share-button"
    ],
    
    // Keyboard Shortcuts
    shortcuts: {
      "Enter": "send message",
      "Space": "activate button",
      "Escape": "cancel",
      "Tab": "next element",
      "Shift+Tab": "previous element"
    },
    
    // Focus Management
    focusManagement: {
      newMessage: "focus on input",
      aiResponse: "focus on response",
      payment: "focus on confirm button",
      error: "focus on error message"
    }
  };
}
```

---

## 9. Performance Interaction Patterns

### 9.1 Cost Optimization Feedback

**Component:** `CostOptimizationFeedback`

```typescript
interface CostOptimizationInteraction {
  // Model Selection Feedback
  modelSelection: {
    haiku: {
      trigger: "simple query",
      feedback: {
        visual: "haiku-indicator",
        audio: "quick-sound",
        screenReader: "Usando Claude Haiku para resposta r√°pida"
      },
      performance: "<1s response time"
    },
    
    sonnet: {
      trigger: "cultural context",
      feedback: {
        visual: "sonnet-indicator", 
        audio: "standard-sound",
        screenReader: "Usando Claude Sonnet para contexto cultural"
      },
      performance: "<2.5s response time"
    },
    
    opus: {
      trigger: "complex analysis",
      feedback: {
        visual: "opus-indicator",
        audio: "advanced-sound", 
        screenReader: "Usando Claude Opus para an√°lise avan√ßada"
      },
      performance: "<5s response time"
    }
  };
  
  // Budget Management
  budgetManagement: {
    dailyTracking: {
      current: "R$ 1.20",
      limit: "R$ 2.00",
      warning: "80% (R$ 1.60)",
      feedback: {
        visual: "progress-bar",
        audio: "warning-sound",
        screenReader: "Aproximando limite do or√ßamento di√°rio"
      }
    },
    
    optimization: {
      trigger: "high cost detected",
      action: "switch to Haiku",
      feedback: {
        visual: "optimization-notification",
        audio: "optimization-sound",
        screenReader: "Otimizando para reduzir custos"
      }
    }
  };
}
```

---

## 10. Success Criteria

### **Interaction Success Metrics:**
- **Cultural Recognition:** 95%+ accuracy for Brazilian patterns
- **Regional Adaptation:** 100% regional expression support
- **Accessibility:** WCAG 2.1 AA compliance for all interactions
- **Performance:** <2s response time for Brazilian users
- **User Satisfaction:** 4.5/5 rating for interaction quality

### **Interaction Requirements:**
- **Voice Input:** Brazilian Portuguese with regional accents
- **Camera Integration:** Receipt scanning with OCR
- **Screen Reader:** Full navigation and announcement support
- **Keyboard Navigation:** Complete keyboard accessibility
- **Haptic Feedback:** Mobile vibration patterns
- **Audio Feedback:** Sound cues for actions

The component interaction specifications ensure RachaAI provides **intuitive, culturally-aware interactions** that are **fully accessible** and **optimized for Brazilian users**. 