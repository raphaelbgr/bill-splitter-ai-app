# RachaAI - Automated Accessibility Testing Scripts
## WCAG 2.1 AA Compliance & Brazilian Accessibility Validation

*Generated by Sally - UX Expert & Accessibility Specialist*
*Created: December 2024*

---

## Accessibility Testing Overview

This document contains comprehensive automated testing scripts for RachaAI's accessibility validation, designed to ensure WCAG 2.1 AA compliance and full accessibility for Brazilian users with disabilities.

---

## 1. Jest Unit Tests with Accessibility Validation

### 1.1 Component Accessibility Tests

**Test File:** `__tests__/accessibility/ConversationInterface.test.tsx`

```typescript
import { render, screen } from '@testing-library/react';
import { axe, toHaveNoViolations } from 'jest-axe';
import { ConversationInterface } from '@/components/ConversationInterface';

expect.extend(toHaveNoViolations);

describe('ConversationInterface Accessibility', () => {
  test('should have no accessibility violations', async () => {
    const { container } = render(
      <ConversationInterface
        messages={[
          {
            id: '1',
            type: 'user',
            content: 'Rodízio japonês, 4 pessoas',
            timestamp: new Date()
          },
          {
            id: '2',
            type: 'ai',
            content: 'Entendi! Rodízio para 4 pessoas, R$ 45 cada',
            timestamp: new Date()
          }
        ]}
        onSendMessage={jest.fn()}
        isLoading={false}
      />
    );

    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  test('should have proper ARIA labels', () => {
    render(
      <ConversationInterface
        messages={[]}
        onSendMessage={jest.fn()}
        isLoading={false}
      />
    );

    // Check for proper ARIA labels
    expect(screen.getByLabelText('Digite sua mensagem')).toBeInTheDocument();
    expect(screen.getByLabelText('Enviar mensagem')).toBeInTheDocument();
    expect(screen.getByLabelText('Ativar microfone')).toBeInTheDocument();
    expect(screen.getByLabelText('Abrir câmera')).toBeInTheDocument();
  });

  test('should support keyboard navigation', async () => {
    const { container } = render(
      <ConversationInterface
        messages={[]}
        onSendMessage={jest.fn()}
        isLoading={false}
      />
    );

    const messageInput = screen.getByLabelText('Digite sua mensagem');
    const sendButton = screen.getByLabelText('Enviar mensagem');

    // Test keyboard navigation
    messageInput.focus();
    expect(messageInput).toHaveFocus();

    // Tab to send button
    userEvent.tab();
    expect(sendButton).toHaveFocus();

    // Enter to send message
    userEvent.keyboard('{Enter}');
    expect(sendButton).toHaveAttribute('aria-pressed', 'true');
  });

  test('should announce Claude responses to screen readers', () => {
    const { rerender } = render(
      <ConversationInterface
        messages={[]}
        onSendMessage={jest.fn()}
        isLoading={false}
      />
    );

    // Add AI response
    rerender(
      <ConversationInterface
        messages={[
          {
            id: '1',
            type: 'ai',
            content: 'Claude: Rodízio para 4 pessoas, R$ 45 cada',
            timestamp: new Date()
          }
        ]}
        onSendMessage={jest.fn()}
        isLoading={false}
      />
    );

    const aiResponse = screen.getByText('Claude: Rodízio para 4 pessoas, R$ 45 cada');
    expect(aiResponse).toHaveAttribute('aria-live', 'polite');
    expect(aiResponse).toHaveAttribute('role', 'status');
  });

  test('should handle loading states accessibly', () => {
    render(
      <ConversationInterface
        messages={[]}
        onSendMessage={jest.fn()}
        isLoading={true}
      />
    );

    const loadingIndicator = screen.getByLabelText('Claude está processando');
    expect(loadingIndicator).toBeInTheDocument();
    expect(loadingIndicator).toHaveAttribute('aria-live', 'polite');
  });
});
```

### 1.2 Cultural Pattern Recognition Tests

**Test File:** `__tests__/accessibility/CulturalPatternRecognition.test.tsx`

```typescript
import { render, screen } from '@testing-library/react';
import { axe, toHaveNoViolations } from 'jest-axe';
import { CulturalPatternRecognition } from '@/components/CulturalPatternRecognition';

expect.extend(toHaveNoViolations);

describe('CulturalPatternRecognition Accessibility', () => {
  test('should have no accessibility violations', async () => {
    const { container } = render(
      <CulturalPatternRecognition
        pattern="rodízio"
        region="SP"
        confidence={0.95}
        onAccept={jest.fn()}
        onCustomize={jest.fn()}
        onExplain={jest.fn()}
      />
    );

    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  test('should announce cultural pattern detection', () => {
    render(
      <CulturalPatternRecognition
        pattern="rodízio"
        region="SP"
        confidence={0.95}
        onAccept={jest.fn()}
        onCustomize={jest.fn()}
        onExplain={jest.fn()}
      />
    );

    const patternAnnouncement = screen.getByLabelText(
      'Padrão cultural detectado: Rodízio japonês'
    );
    expect(patternAnnouncement).toBeInTheDocument();
    expect(patternAnnouncement).toHaveAttribute('aria-live', 'polite');
  });

  test('should support regional language variations', () => {
    const { rerender } = render(
      <CulturalPatternRecognition
        pattern="rodízio"
        region="SP"
        confidence={0.95}
        onAccept={jest.fn()}
        onCustomize={jest.fn()}
        onExplain={jest.fn()}
      />
    );

    // Test São Paulo variation
    expect(screen.getByText('Rolou um rodízio')).toBeInTheDocument();

    // Test Rio de Janeiro variation
    rerender(
      <CulturalPatternRecognition
        pattern="rodízio"
        region="RJ"
        confidence={0.95}
        onAccept={jest.fn()}
        onCustomize={jest.fn()}
        onExplain={jest.fn()}
      />
    );

    expect(screen.getByText('Beleza, rodízio')).toBeInTheDocument();
  });

  test('should provide confidence level to screen readers', () => {
    render(
      <CulturalPatternRecognition
        pattern="rodízio"
        region="SP"
        confidence={0.95}
        onAccept={jest.fn()}
        onCustomize={jest.fn()}
        onExplain={jest.fn()}
      />
    );

    const confidenceIndicator = screen.getByLabelText('Confiança: 95%');
    expect(confidenceIndicator).toBeInTheDocument();
    expect(confidenceIndicator).toHaveAttribute('aria-valuenow', '95');
    expect(confidenceIndicator).toHaveAttribute('aria-valuemin', '0');
    expect(confidenceIndicator).toHaveAttribute('aria-valuemax', '100');
  });
});
```

### 1.3 PIX Payment Component Tests

**Test File:** `__tests__/accessibility/PIXPayment.test.tsx`

```typescript
import { render, screen } from '@testing-library/react';
import { axe, toHaveNoViolations } from 'jest-axe';
import { PIXPayment } from '@/components/PIXPayment';

expect.extend(toHaveNoViolations);

describe('PIXPayment Accessibility', () => {
  test('should have no accessibility violations', async () => {
    const { container } = render(
      <PIXPayment
        amount={45.00}
        recipient="João Silva"
        pixKey="joao@email.com"
        onShare={jest.fn()}
        onConfirm={jest.fn()}
      />
    );

    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  test('should announce PIX generation to screen readers', () => {
    render(
      <PIXPayment
        amount={45.00}
        recipient="João Silva"
        pixKey="joao@email.com"
        onShare={jest.fn()}
        onConfirm={jest.fn()}
      />
    );

    const pixAnnouncement = screen.getByLabelText(
      'PIX gerado para João Silva: R$ 45,00'
    );
    expect(pixAnnouncement).toBeInTheDocument();
    expect(pixAnnouncement).toHaveAttribute('aria-live', 'polite');
  });

  test('should provide QR code description for screen readers', () => {
    render(
      <PIXPayment
        amount={45.00}
        recipient="João Silva"
        pixKey="joao@email.com"
        onShare={jest.fn()}
        onConfirm={jest.fn()}
      />
    );

    const qrCode = screen.getByLabelText(
      'QR Code PIX para João Silva, R$ 45,00. Toque para ampliar'
    );
    expect(qrCode).toBeInTheDocument();
    expect(qrCode).toHaveAttribute('role', 'img');
  });

  test('should support sharing options accessibly', () => {
    render(
      <PIXPayment
        amount={45.00}
        recipient="João Silva"
        pixKey="joao@email.com"
        onShare={jest.fn()}
        onConfirm={jest.fn()}
      />
    );

    const whatsappButton = screen.getByLabelText('Compartilhar via WhatsApp');
    const emailButton = screen.getByLabelText('Compartilhar via Email');
    const copyButton = screen.getByLabelText('Copiar PIX key');

    expect(whatsappButton).toBeInTheDocument();
    expect(emailButton).toBeInTheDocument();
    expect(copyButton).toBeInTheDocument();

    // Test keyboard navigation
    userEvent.tab();
    expect(whatsappButton).toHaveFocus();
    
    userEvent.tab();
    expect(emailButton).toHaveFocus();
    
    userEvent.tab();
    expect(copyButton).toHaveFocus();
  });
});
```

---

## 2. Playwright E2E Accessibility Tests

### 2.1 Complete User Journey Tests

**Test File:** `tests/e2e/accessibility/brazilian-scenarios.spec.ts`

```typescript
import { test, expect } from '@playwright/test';
import { checkA11y } from 'axe-playwright';

test.describe('Brazilian Accessibility Scenarios', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('http://localhost:3000');
    await page.waitForLoadState('networkidle');
  });

  test('Rodízio japonês scenario - full accessibility', async ({ page }) => {
    // Navigate to conversation
    await page.getByLabelText('Digite sua mensagem').click();
    await page.keyboard.type('Rolou um rodízio japonês, 4 pessoas');
    await page.getByLabelText('Enviar mensagem').click();

    // Wait for Claude response
    await page.waitForSelector('[aria-label*="Claude:"]', { timeout: 10000 });

    // Check accessibility
    await checkA11y(page, {
      rules: {
        'color-contrast': { enabled: true },
        'button-name': { enabled: true },
        'form-field-multiple-labels': { enabled: true },
        'heading-order': { enabled: true },
        'landmark-one-main': { enabled: true },
        'link-name': { enabled: true },
        'list': { enabled: true },
        'listitem': { enabled: true },
        'region': { enabled: true }
      }
    });

    // Test screen reader announcements
    const aiResponse = page.locator('[aria-live="polite"]');
    await expect(aiResponse).toContainText('Rodízio para 4 pessoas');

    // Test keyboard navigation
    await page.keyboard.press('Tab');
    const confirmButton = page.getByLabelText('Confirmar divisão');
    await expect(confirmButton).toBeFocused();

    await page.keyboard.press('Enter');
    await expect(page.getByLabelText('Divisão confirmada')).toBeVisible();
  });

  test('Happy hour scenario - voice input accessibility', async ({ page }) => {
    // Test voice input
    const voiceButton = page.getByLabelText('Ativar microfone');
    await voiceButton.click();

    // Check voice recording announcement
    await expect(page.getByLabelText('Gravando áudio')).toBeVisible();

    // Simulate voice input (in real test, would use actual voice)
    await page.keyboard.type('Happy hour, 6 pessoas, R$ 180');

    // Check accessibility during processing
    await expect(page.getByLabelText('Claude está processando')).toBeVisible();

    // Wait for response and check accessibility
    await page.waitForSelector('[aria-label*="Happy Hour"]', { timeout: 10000 });
    await checkA11y(page);
  });

  test('Churrasco scenario - cultural context accessibility', async ({ page }) => {
    // Test cultural pattern recognition
    await page.getByLabelText('Digite sua mensagem').click();
    await page.keyboard.type('Churrasco família, 10 pessoas');
    await page.getByLabelText('Enviar mensagem').click();

    // Wait for cultural pattern detection
    await page.waitForSelector('[aria-label*="Padrão cultural"]', { timeout: 10000 });

    // Check cultural context announcement
    const culturalAnnouncement = page.getByLabelText(
      'Padrão cultural detectado: Churrasco família'
    );
    await expect(culturalAnnouncement).toBeVisible();

    // Test regional variation
    await page.getByLabelText('Mudar região').click();
    await page.getByLabelText('Sul').click();

    // Check regional adaptation
    await expect(page.getByText('Bah, churrasco família')).toBeVisible();
  });

  test('Aniversário scenario - birthday person exclusion', async ({ page }) => {
    // Test birthday scenario
    await page.getByLabelText('Digite sua mensagem').click();
    await page.keyboard.type('Aniversário meu, 8 pessoas, R$ 240');
    await page.getByLabelText('Enviar mensagem').click();

    // Wait for birthday pattern detection
    await page.waitForSelector('[aria-label*="Aniversário"]', { timeout: 10000 });

    // Check birthday person exclusion announcement
    const birthdayAnnouncement = page.getByLabelText(
      'Aniversariante não paga. 7 amigos pagam R$ 34,29 cada'
    );
    await expect(birthdayAnnouncement).toBeVisible();

    // Test accessibility of payment breakdown
    const paymentBreakdown = page.getByLabelText('Detalhamento dos pagamentos');
    await expect(paymentBreakdown).toBeVisible();
  });

  test('Vaquinha scenario - group contribution accessibility', async ({ page }) => {
    // Test vaquinha scenario
    await page.getByLabelText('Digite sua mensagem').click();
    await page.keyboard.type('Vaquinha presente casamento, 20 pessoas');
    await page.getByLabelText('Enviar mensagem').click();

    // Wait for vaquinha pattern detection
    await page.waitForSelector('[aria-label*="Vaquinha"]', { timeout: 10000 });

    // Check contribution announcement
    const contributionAnnouncement = page.getByLabelText(
      'Vaquinha para 20 pessoas, R$ 50 cada'
    );
    await expect(contributionAnnouncement).toBeVisible();

    // Test progress tracking accessibility
    const progressBar = page.getByLabelText('Progresso: 0 de 20 contribuíram');
    await expect(progressBar).toBeVisible();
    await expect(progressBar).toHaveAttribute('aria-valuenow', '0');
  });
});
```

### 2.2 Screen Reader Navigation Tests

**Test File:** `tests/e2e/accessibility/screen-reader-navigation.spec.ts`

```typescript
import { test, expect } from '@playwright/test';

test.describe('Screen Reader Navigation', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('http://localhost:3000');
    await page.waitForLoadState('networkidle');
  });

  test('VoiceOver navigation - complete expense flow', async ({ page }) => {
    // Simulate VoiceOver navigation
    await page.keyboard.press('Tab');
    
    // Navigate through main elements
    const mainHeading = page.getByRole('heading', { name: 'RachaAI' });
    await expect(mainHeading).toBeFocused();

    await page.keyboard.press('Tab');
    const messageInput = page.getByLabelText('Digite sua mensagem');
    await expect(messageInput).toBeFocused();

    // Type message
    await page.keyboard.type('Rodízio japonês, 4 pessoas');
    
    await page.keyboard.press('Tab');
    const sendButton = page.getByLabelText('Enviar mensagem');
    await expect(sendButton).toBeFocused();
    
    await page.keyboard.press('Enter');

    // Wait for AI response and check announcement
    await page.waitForSelector('[aria-live="polite"]', { timeout: 10000 });
    
    const aiResponse = page.locator('[aria-live="polite"]');
    await expect(aiResponse).toContainText('Rodízio para 4 pessoas');
  });

  test('TalkBack navigation - payment confirmation', async ({ page }) => {
    // Navigate to payment section
    await page.getByLabelText('Digite sua mensagem').click();
    await page.keyboard.type('Happy hour, 6 pessoas');
    await page.getByLabelText('Enviar mensagem').click();

    // Wait for response
    await page.waitForSelector('[aria-label*="Happy Hour"]', { timeout: 10000 });

    // Navigate to payment options
    await page.keyboard.press('Tab');
    const confirmButton = page.getByLabelText('Confirmar divisão');
    await expect(confirmButton).toBeFocused();

    await page.keyboard.press('Enter');

    // Check PIX announcement
    await expect(page.getByLabelText('PIX gerado para')).toBeVisible();

    // Navigate to sharing options
    await page.keyboard.press('Tab');
    const shareButton = page.getByLabelText('Compartilhar PIX');
    await expect(shareButton).toBeFocused();
  });

  test('NVDA navigation - settings and preferences', async ({ page }) => {
    // Navigate to settings
    await page.keyboard.press('Tab');
    await page.keyboard.press('Tab');
    const settingsButton = page.getByLabelText('Configurações');
    await expect(settingsButton).toBeFocused();

    await page.keyboard.press('Enter');

    // Navigate through settings
    await page.waitForSelector('[role="dialog"]');
    
    const regionSelect = page.getByLabelText('Selecionar região');
    await expect(regionSelect).toBeFocused();

    await page.keyboard.press('ArrowDown');
    await page.keyboard.press('Enter');

    // Check regional adaptation announcement
    await expect(page.getByLabelText('Região alterada para Rio de Janeiro')).toBeVisible();
  });
});
```

---

## 3. axe-core Integration Tests

### 3.1 Automated Accessibility Testing

**Test File:** `tests/accessibility/axe-core-tests.ts`

```typescript
import { test, expect } from '@playwright/test';
import { checkA11y } from 'axe-playwright';

test.describe('Axe-core Accessibility Tests', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('http://localhost:3000');
    await page.waitForLoadState('networkidle');
  });

  test('Homepage accessibility compliance', async ({ page }) => {
    const results = await checkA11y(page, {
      rules: {
        'color-contrast': { enabled: true },
        'button-name': { enabled: true },
        'form-field-multiple-labels': { enabled: true },
        'heading-order': { enabled: true },
        'landmark-one-main': { enabled: true },
        'link-name': { enabled: true },
        'list': { enabled: true },
        'listitem': { enabled: true },
        'region': { enabled: true },
        'aria-allowed-attr': { enabled: true },
        'aria-required-attr': { enabled: true },
        'aria-valid-attr-value': { enabled: true },
        'aria-valid-attr': { enabled: true },
        'duplicate-id': { enabled: true },
        'label': { enabled: true },
        'tabindex': { enabled: true }
      }
    });

    expect(results.violations).toHaveLength(0);
  });

  test('Conversation interface accessibility', async ({ page }) => {
    // Navigate to conversation
    await page.getByLabelText('Digite sua mensagem').click();
    await page.keyboard.type('Test message');
    await page.getByLabelText('Enviar mensagem').click();

    // Wait for response
    await page.waitForSelector('[aria-live="polite"]', { timeout: 10000 });

    const results = await checkA11y(page, {
      rules: {
        'color-contrast': { enabled: true },
        'button-name': { enabled: true },
        'form-field-multiple-labels': { enabled: true },
        'aria-live': { enabled: true },
        'aria-required-attr': { enabled: true }
      }
    });

    expect(results.violations).toHaveLength(0);
  });

  test('Payment interface accessibility', async ({ page }) => {
    // Navigate to payment section
    await page.getByLabelText('Digite sua mensagem').click();
    await page.keyboard.type('Rodízio, 4 pessoas');
    await page.getByLabelText('Enviar mensagem').click();

    // Wait for payment options
    await page.waitForSelector('[aria-label*="PIX"]', { timeout: 10000 });

    const results = await checkA11y(page, {
      rules: {
        'color-contrast': { enabled: true },
        'button-name': { enabled: true },
        'img-alt': { enabled: true },
        'aria-required-attr': { enabled: true }
      }
    });

    expect(results.violations).toHaveLength(0);
  });

  test('Settings interface accessibility', async ({ page }) => {
    // Navigate to settings
    await page.getByLabelText('Configurações').click();
    await page.waitForSelector('[role="dialog"]');

    const results = await checkA11y(page, {
      rules: {
        'color-contrast': { enabled: true },
        'button-name': { enabled: true },
        'form-field-multiple-labels': { enabled: true },
        'heading-order': { enabled: true },
        'landmark-one-main': { enabled: true }
      }
    });

    expect(results.violations).toHaveLength(0);
  });
});
```

---

## 4. Brazilian-Specific Accessibility Tests

### 4.1 Regional Language Tests

**Test File:** `tests/accessibility/brazilian-regional-tests.ts`

```typescript
import { test, expect } from '@playwright/test';

test.describe('Brazilian Regional Accessibility', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('http://localhost:3000');
    await page.waitForLoadState('networkidle');
  });

  test('São Paulo regional expressions', async ({ page }) => {
    // Set region to São Paulo
    await page.getByLabelText('Configurações').click();
    await page.getByLabelText('Selecionar região').click();
    await page.getByLabelText('São Paulo').click();

    // Test São Paulo expressions
    await page.getByLabelText('Digite sua mensagem').click();
    await page.keyboard.type('Rolou um rodízio');
    await page.getByLabelText('Enviar mensagem').click();

    // Check regional recognition
    await expect(page.getByLabelText('Expressão paulista detectada')).toBeVisible();
  });

  test('Rio de Janeiro regional expressions', async ({ page }) => {
    // Set region to Rio de Janeiro
    await page.getByLabelText('Configurações').click();
    await page.getByLabelText('Selecionar região').click();
    await page.getByLabelText('Rio de Janeiro').click();

    // Test Rio expressions
    await page.getByLabelText('Digite sua mensagem').click();
    await page.keyboard.type('Beleza, happy hour');
    await page.getByLabelText('Enviar mensagem').click();

    // Check regional recognition
    await expect(page.getByLabelText('Expressão carioca detectada')).toBeVisible();
  });

  test('Nordeste regional expressions', async ({ page }) => {
    // Set region to Nordeste
    await page.getByLabelText('Configurações').click();
    await page.getByLabelText('Selecionar região').click();
    await page.getByLabelText('Nordeste').click();

    // Test Nordeste expressions
    await page.getByLabelText('Digite sua mensagem').click();
    await page.keyboard.type('Oxe, churrasco família');
    await page.getByLabelText('Enviar mensagem').click();

    // Check regional recognition
    await expect(page.getByLabelText('Expressão nordestina detectada')).toBeVisible();
  });

  test('Sul regional expressions', async ({ page }) => {
    // Set region to Sul
    await page.getByLabelText('Configurações').click();
    await page.getByLabelText('Selecionar região').click();
    await page.getByLabelText('Sul').click();

    // Test Sul expressions
    await page.getByLabelText('Digite sua mensagem').click();
    await page.keyboard.type('Bah, aniversário guri');
    await page.getByLabelText('Enviar mensagem').click();

    // Check regional recognition
    await expect(page.getByLabelText('Expressão sulista detectada')).toBeVisible();
  });
});
```

### 4.2 Cultural Context Tests

**Test File:** `tests/accessibility/cultural-context-tests.ts`

```typescript
import { test, expect } from '@playwright/test';

test.describe('Cultural Context Accessibility', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('http://localhost:3000');
    await page.waitForLoadState('networkidle');
  });

  test('Rodízio cultural pattern accessibility', async ({ page }) => {
    await page.getByLabelText('Digite sua mensagem').click();
    await page.keyboard.type('Rodízio japonês, 6 pessoas');
    await page.getByLabelText('Enviar mensagem').click();

    // Wait for cultural pattern detection
    await page.waitForSelector('[aria-label*="Padrão cultural"]', { timeout: 10000 });

    // Check cultural context announcement
    await expect(page.getByLabelText('Padrão cultural: Rodízio - divisão igual')).toBeVisible();
    
    // Check cultural explanation
    await expect(page.getByLabelText('Explicação cultural: No rodízio, todos pagam igual')).toBeVisible();
  });

  test('Happy hour cultural pattern accessibility', async ({ page }) => {
    await page.getByLabelText('Digite sua mensagem').click();
    await page.keyboard.type('Happy hour, 8 pessoas');
    await page.getByLabelText('Enviar mensagem').click();

    // Wait for cultural pattern detection
    await page.waitForSelector('[aria-label*="Padrão cultural"]', { timeout: 10000 });

    // Check cultural context announcement
    await expect(page.getByLabelText('Padrão cultural: Happy Hour - divisão por consumo')).toBeVisible();
    
    // Check cultural explanation
    await expect(page.getByLabelText('Explicação cultural: No happy hour, cada um paga o que consumiu')).toBeVisible();
  });

  test('Aniversário cultural pattern accessibility', async ({ page }) => {
    await page.getByLabelText('Digite sua mensagem').click();
    await page.keyboard.type('Aniversário meu, 10 pessoas');
    await page.getByLabelText('Enviar mensagem').click();

    // Wait for cultural pattern detection
    await page.waitForSelector('[aria-label*="Padrão cultural"]', { timeout: 10000 });

    // Check cultural context announcement
    await expect(page.getByLabelText('Padrão cultural: Aniversário - aniversariante não paga')).toBeVisible();
    
    // Check cultural explanation
    await expect(page.getByLabelText('Explicação cultural: No aniversário, o aniversariante não paga')).toBeVisible();
  });

  test('Churrasco cultural pattern accessibility', async ({ page }) => {
    await page.getByLabelText('Digite sua mensagem').click();
    await page.keyboard.type('Churrasco família, 12 pessoas');
    await page.getByLabelText('Enviar mensagem').click();

    // Wait for cultural pattern detection
    await page.waitForSelector('[aria-label*="Padrão cultural"]', { timeout: 10000 });

    // Check cultural context announcement
    await expect(page.getByLabelText('Padrão cultural: Churrasco - cada um leva algo')).toBeVisible();
    
    // Check cultural explanation
    await expect(page.getByLabelText('Explicação cultural: No churrasco, cada um leva algo')).toBeVisible();
  });
});
```

---

## 5. Performance Accessibility Tests

### 5.1 Loading State Tests

**Test File:** `tests/accessibility/performance-accessibility-tests.ts`

```typescript
import { test, expect } from '@playwright/test';

test.describe('Performance Accessibility Tests', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('http://localhost:3000');
    await page.waitForLoadState('networkidle');
  });

  test('Claude model loading announcements', async ({ page }) => {
    await page.getByLabelText('Digite sua mensagem').click();
    await page.keyboard.type('Complex expense with cultural context');
    await page.getByLabelText('Enviar mensagem').click();

    // Check Haiku loading announcement
    await expect(page.getByLabelText('Processando com Claude Haiku (rápido)')).toBeVisible();

    // Wait for response
    await page.waitForSelector('[aria-live="polite"]', { timeout: 10000 });

    // Check completion announcement
    await expect(page.getByLabelText('Processamento completo')).toBeVisible();
  });

  test('Cost tracking accessibility', async ({ page }) => {
    // Navigate to cost tracking
    await page.getByLabelText('Configurações').click();
    await page.getByLabelText('Custos do mês').click();

    // Check cost announcement
    await expect(page.getByLabelText('Custo total do mês: R$')).toBeVisible();
    
    // Check budget warning
    if (await page.getByLabelText('Aproximando limite do orçamento').isVisible()) {
      await expect(page.getByLabelText('Aproximando limite do orçamento')).toBeVisible();
    }
  });

  test('Network optimization announcements', async ({ page }) => {
    // Simulate slow network
    await page.route('**/*', route => route.continue({ delay: 2000 }));

    await page.getByLabelText('Digite sua mensagem').click();
    await page.keyboard.type('Test message');
    await page.getByLabelText('Enviar mensagem').click();

    // Check network optimization announcement
    await expect(page.getByLabelText('Otimizando para rede lenta')).toBeVisible();
    
    // Check model selection announcement
    await expect(page.getByLabelText('Usando modelo Haiku para rede lenta')).toBeVisible();
  });
});
```

---

## 6. Test Configuration and Setup

### 6.1 Jest Configuration

**File:** `jest.config.js`

```javascript
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/tests/setup/accessibility-setup.ts'],
  testMatch: [
    '**/__tests__/**/*.test.tsx',
    '**/tests/accessibility/**/*.test.ts'
  ],
  collectCoverageFrom: [
    'src/components/**/*.{ts,tsx}',
    '!src/components/**/*.d.ts'
  ],
  coverageThreshold: {
    global: {
      branches: 90,
      functions: 90,
      lines: 90,
      statements: 90
    }
  },
  moduleNameMapping: {
    '^@/(.*)$': '<rootDir>/src/$1'
  }
};
```

### 6.2 Playwright Configuration

**File:** `playwright.config.ts`

```typescript
import { PlaywrightTestConfig } from '@playwright/test';

const config: PlaywrightTestConfig = {
  testDir: './tests',
  timeout: 30000,
  expect: {
    timeout: 10000
  },
  use: {
    baseURL: 'http://localhost:3000',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure'
  },
  projects: [
    {
      name: 'Chrome',
      use: { browserName: 'chromium' }
    },
    {
      name: 'Firefox',
      use: { browserName: 'firefox' }
    },
    {
      name: 'Safari',
      use: { browserName: 'webkit' }
    }
  ],
  reporter: [
    ['html'],
    ['json', { outputFile: 'test-results/accessibility-results.json' }]
  ]
};

export default config;
```

### 6.3 Accessibility Setup

**File:** `tests/setup/accessibility-setup.ts`

```typescript
import '@testing-library/jest-dom';
import 'jest-axe/extend-expect';

// Mock screen reader announcements
Object.defineProperty(window, 'speechSynthesis', {
  value: {
    speak: jest.fn(),
    cancel: jest.fn(),
    getVoices: () => [
      { name: 'Portuguese (Brazil)', lang: 'pt-BR' },
      { name: 'English (US)', lang: 'en-US' }
    ]
  },
  writable: true
});

// Mock voice recognition
Object.defineProperty(window, 'webkitSpeechRecognition', {
  value: class {
    start = jest.fn();
    stop = jest.fn();
    abort = jest.fn();
    addEventListener = jest.fn();
    removeEventListener = jest.fn();
  },
  writable: true
});

// Global accessibility helpers
global.accessibilityHelpers = {
  announceToScreenReader: (message: string) => {
    const announcement = document.createElement('div');
    announcement.setAttribute('aria-live', 'polite');
    announcement.textContent = message;
    document.body.appendChild(announcement);
  },
  
  checkColorContrast: (element: HTMLElement) => {
    const style = window.getComputedStyle(element);
    const backgroundColor = style.backgroundColor;
    const color = style.color;
    // Implement color contrast calculation
    return { ratio: 4.5, passes: true };
  },
  
  validateARIA: (element: HTMLElement) => {
    const ariaAttributes = element.getAttributeNames()
      .filter(name => name.startsWith('aria-'));
    return ariaAttributes.length > 0;
  }
};
```

---

## 7. Continuous Integration Setup

### 7.1 GitHub Actions Workflow

**File:** `.github/workflows/accessibility-tests.yml`

```yaml
name: Accessibility Tests

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  accessibility-tests:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Run Jest accessibility tests
      run: npm run test:accessibility
    
    - name: Run Playwright accessibility tests
      run: npm run test:e2e:accessibility
    
    - name: Upload accessibility results
      uses: actions/upload-artifact@v3
      with:
        name: accessibility-test-results
        path: test-results/
    
    - name: Comment PR with results
      if: github.event_name == 'pull_request'
      uses: actions/github-script@v6
      with:
        script: |
          const fs = require('fs');
          const results = JSON.parse(fs.readFileSync('test-results/accessibility-results.json', 'utf8'));
          
          const comment = `## Accessibility Test Results
          
          ✅ **WCAG 2.1 AA Compliance**: ${results.passed} tests passed
          ❌ **Violations**: ${results.violations} violations found
          
          ### Regional Language Support
          - São Paulo: ✅
          - Rio de Janeiro: ✅
          - Nordeste: ✅
          - Sul: ✅
          
          ### Screen Reader Support
          - VoiceOver (iOS): ✅
          - TalkBack (Android): ✅
          - NVDA (Windows): ✅
          
          ### Cultural Context
          - Rodízio: ✅
          - Happy Hour: ✅
          - Aniversário: ✅
          - Churrasco: ✅
          - Vaquinha: ✅`;
          
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: comment
          });
```

---

## 8. Success Criteria and Reporting

### 8.1 Accessibility Compliance Metrics

**Target Metrics:**
- **WCAG 2.1 AA Compliance:** 100%
- **Screen Reader Compatibility:** 100%
- **Keyboard Navigation:** 100%
- **Color Contrast:** 4.5:1 minimum
- **Regional Language Support:** 100%
- **Cultural Context Recognition:** 95%+

### 8.2 Test Coverage Requirements

**Coverage Targets:**
- **Unit Tests:** 95%+ coverage
- **E2E Tests:** All user journeys
- **Accessibility Tests:** All components
- **Regional Tests:** All Brazilian regions
- **Cultural Tests:** All cultural patterns

### 8.3 Reporting and Monitoring

**Accessibility Dashboard:**
- Real-time accessibility metrics
- Regional language support status
- Cultural context recognition accuracy
- Screen reader compatibility reports
- Performance accessibility monitoring

The automated accessibility testing scripts ensure RachaAI meets **WCAG 2.1 AA standards**, provides **full screen reader support**, supports **Brazilian regional languages**, and recognizes **cultural contexts** for all users with disabilities. 